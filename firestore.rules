/**
 * @fileoverview Firestore Security Rules for the AAURA platform (Full Social Network Optimized)
 *
 * Core Philosophy:
 * - Public content (media, posts, stories, contests, rituals, etc.) can be viewed by anyone.
 * - Only authenticated users can create or interact (likes, comments, follows).
 * - Users fully own their own data; admins can moderate globally.
 * - User-to-user social actions (follow, notifications, etc.) are structured like modern social platforms.
 *
 * Data Structure:
 * - User profiles and private data are stored under `/users/{userId}`.
 * - Public content like media, temples, stories, and posts are stored in top-level collections.
 * - Social graph data (followers, following) is stored as subcollections under each user.
 *
 * Key Security Decisions:
 * - User listing is disabled.
 * - Followers/following lists are publicly readable.
 * - User-owned data is strictly controlled; only the user can modify it.
 * - Admin role can override user ownership for moderation.
 *
 * Denormalization for Authorization:
 * - Many of the existing rules check for document ownership using the `ownsDoc()` helper function. This function uses `resource.data.authorId` or `resource.data.createdBy`.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ------------------------------------------------------------
    // ðŸ”¹ Utility Functions
    // ------------------------------------------------------------

    function isSignedIn() {
      return request.auth != null;
    }

    function isOwner(userId) {
      return isSignedIn() && request.auth.uid == userId;
    }

    function isExistingOwner(userId) {
      return isOwner(userId) && resource != null;
    }

    function ownsDoc() {
      return isSignedIn() &&
        (request.auth.uid == resource.data.authorId ||
         request.auth.uid == resource.data.createdBy);
    }

    function isAdmin() {
      return isSignedIn() &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == "admin";
    }

    // ------------------------------------------------------------
    // ðŸ”¹ User Profiles and Private Subcollections
    // ------------------------------------------------------------

    /**
     * @description Manages user profiles. Only the user or an admin can read, create, update, or delete.
     * @path /users/{userId}
     * @allow (create) User with ID 'user123' creates their profile.
     * @deny (create) User with ID 'user456' tries to create a profile for 'user123'.
     * @principle Enforces document ownership and admin override.
     */
    match /users/{userId} {
      allow get: if isOwner(userId) || isAdmin();
      allow list: if false;
      allow create: if isOwner(userId) || isAdmin();
      allow update: if isOwner(userId) || isAdmin();
      allow delete: if isOwner(userId) || isAdmin();

      // ðŸ‘£ Followers & Following system (Social Graph)

      /**
       * @description Allows anyone to read who follows whom. Authenticated users can create follow relationships for themselves, owners can delete.
       * @path /users/{userId}/followers/{followerId}
       * @allow (read) Anyone reads the followers list of a user.
       * @allow (create) User 'user456' follows user 'user123'
       * @deny (create) User 'user789' tries to follow user 'user123' on behalf of 'user456'.
       * @principle Public read for social graph, authenticated create and owner/admin delete.
       */
      match /followers/{followerId} {
        allow get: if true;
        allow list: if true;
        allow create: if isSignedIn() && request.auth.uid == followerId;
        allow update: if false;
        allow delete: if request.auth.uid == followerId || isAdmin();
      }

      /**
       * @description Allows anyone to read who is being followed by whom. Authenticated users can create following relationships for themselves, owners can delete.
       * @path /users/{userId}/following/{followingId}
       * @allow (read) Anyone reads the following list of a user.
       * @allow (create) User 'user123' follows user 'user456'.
       * @deny (create) User 'user123' tries to follow user 'user456' on behalf of 'user789'.
       * @principle Public read for social graph, authenticated create and owner/admin delete.
       */
      match /following/{followingId} {
        allow get: if true;
        allow list: if true;
        allow create: if isSignedIn() && request.auth.uid == userId;
        allow update: if false;
        allow delete: if request.auth.uid == userId || isAdmin();
      }

      // ðŸ”” Notifications

      /**
       * @description Only the user can read their own notifications. Admins can create notifications.
       * @path /users/{userId}/notifications/{notifId}
       * @allow (read) User 'user123' reads their own notifications.
       * @allow (create) An admin creates a notification for user 'user123'.
       * @deny (read) User 'user456' tries to read notifications for 'user123'.
       * @principle Owner-only read for notifications, admin override for create.
       */
      match /notifications/{notifId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if isAdmin();
        allow update: if false;
        allow delete: if isOwner(userId) || isAdmin();
      }

      // User private subcollections (like contest progress, bookmarks, etc.)

      /**
       * @description User contest progress. Only the owner can read/write.
       * @path /users/{userId}/contestProgress/{contestId}
       * @allow (read) User 'user123' reads their own contest progress.
       * @allow (write) User 'user123' updates their own contest progress.
       * @deny (read) User 'user456' tries to read contest progress for 'user123'.
       * @principle Owner-only read/write for contest progress.
       */
      match /contestProgress/{contestId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if isOwner(userId);
        allow update: if isOwner(userId);
        allow delete: if isOwner(userId) || isAdmin();
      }

      /**
       * @description User bookmarks. Only the owner can read/write.
       * @path /users/{userId}/bookmarks/{bookmarkId}
       * @allow (read) User 'user123' reads their own bookmarks.
       * @allow (write) User 'user123' updates their own bookmarks.
       * @deny (read) User 'user456' tries to read bookmarks for 'user123'.
       * @principle Owner-only read/write for bookmarks.
       */
      match /bookmarks/{bookmarkId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if isOwner(userId);
        allow update: if isOwner(userId);
        allow delete: if isOwner(userId) || isAdmin();
      }

      /**
       * @description Virtual offerings by the user. Only the owner can read/write.
       * @path /users/{userId}/virtualOfferings/{offeringId}
       * @allow (read) User 'user123' reads their own virtual offerings.
       * @allow (write) User 'user123' updates their own virtual offerings.
       * @deny (read) User 'user456' tries to read virtual offerings for 'user123'.
       * @principle Owner-only read/write for virtual offerings.
       */
      match /virtualOfferings/{offeringId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if isOwner(userId);
        allow update: if isOwner(userId);
        allow delete: if isOwner(userId) || isAdmin();
      }

       /**
        * @description User's cart. Only the owner can read/write.
        * @path /users/{userId}/cart/{productId}
        * @allow (read) User 'user123' reads their own cart.
        * @allow (write) User 'user123' updates their own cart.
        * @deny (read) User 'user456' tries to read cart for 'user123'.
        * @principle Owner-only read/write for cart.
        */
      match /cart/{productId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if isOwner(userId);
        allow update: if isOwner(userId);
        allow delete: if isOwner(userId) || isAdmin();
      }

      /**
       * @description Orders by the user. Only the owner can read/write.
       * @path /users/{userId}/orders/{orderId}
       * @allow (read) User 'user123' reads their own orders.
       * @allow (write) User 'user123' updates their own orders.
       * @deny (read) User 'user456' tries to read orders for 'user123'.
       * @principle Owner-only read/write for orders.
       */
      match /orders/{orderId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if isOwner(userId);
        allow update: if isOwner(userId);
        allow delete: if isOwner(userId) || isAdmin();
      }

      /**
       * @description User playlists. Only the owner can read/write.
       * @path /users/{userId}/playlists/{playlistId}
       * @allow (read) User 'user123' reads their own playlists.
       * @allow (write) User 'user123' updates their own playlists.
       * @deny (read) User 'user456' tries to read playlists for 'user123'.
       * @principle Owner-only read/write for playlists.
       */
      match /playlists/{playlistId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if isOwner(userId);
        allow update: if isOwner(userId);
        allow delete: if isOwner(userId) || isAdmin();
      }

      /**
       * @description User challenges progress. Only the owner can read/write.
       * @path /users/{userId}/challenges/{challengeId}
       * @allow (read) User 'user123' reads their own challenges progress.
       * @allow (write) User 'user123' updates their own challenges progress.
       * @deny (read) User 'user456' tries to read challenges progress for 'user123'.
       * @principle Owner-only read/write for challenges progress.
       */
      match /challenges/{challengeId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if isOwner(userId);
        allow update: if isOwner(userId);
        allow delete: if isOwner(userId) || isAdmin();
      }

      /**
       * @description User horoscopes. Only the owner can read/write.
       * @path /users/{userId}/horoscopes/{horoscopeId}
       * @allow (read) User 'user123' reads their own horoscope.
       * @deny (read) User 'user456' tries to read horoscope for 'user123'.
       * @principle Owner-only read/write for horoscopes.
       */
      match /horoscopes/{horoscopeId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if isOwner(userId);
        allow update: if isOwner(userId);
        allow delete: if isOwner(userId) || isAdmin();
      }

       /**
        * @description User preferences. Only the owner can read/write.
        * @path /users/{userId}/preferences/default
        * @allow (read) User 'user123' reads their own preferences.
        * @allow (write) User 'user123' updates their own preferences.
        * @deny (read) User 'user456' tries to read preferences for 'user123'.
        * @principle Owner-only read/write for preferences.
        */
      match /preferences/default {
        allow get: if isOwner(userId);
        allow list: if false;
        allow create: if isOwner(userId);
        allow update: if isOwner(userId);
        allow delete: if isOwner(userId) || isAdmin();
      }

      /**
       * @description User badges. Only the owner can read/write.
       * @path /users/{userId}/badges/{badgeId}
       * @allow (read) User 'user123' reads their own badges.
       * @deny (read) User 'user456' tries to read badges for 'user123'.
       * @principle Owner-only read/write for badges.
       */
      match /badges/{badgeId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if isOwner(userId);
        allow update: if isOwner(userId);
        allow delete: if isOwner(userId) || isAdmin();
      }
    }

    // ------------------------------------------------------------
    // ðŸ”¹ Public Collections
    // ------------------------------------------------------------

    /**
     * @description Allows anyone to read contests. Only signed-in users can create. Update/delete requires ownership or admin.
     * @path /contests/{contestId}
     * @allow (read) Anyone reads a contest.
     * @allow (create) User 'user123' creates a new contest.
     * @deny (update) User 'user456' tries to update a contest they don't own.
     * @principle Public read, authenticated create, owner/admin update/delete.
     */
    match /contests/{contestId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();
    }

    /**
     * @description Allows anyone to read media. Only signed-in users can create. Update/delete requires ownership or admin.
     * @path /media/{mediaId}
     * @allow (read) Anyone reads a media item.
     * @allow (create) User 'user123' creates a new media item.
     * @deny (update) User 'user456' tries to update a media item they don't own.
     * @principle Public read, authenticated create, owner/admin update/delete.
     */
    match /media/{mediaId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();

      /**
       * @description Allows anyone to read comments. Only signed-in users can create. Update/delete requires ownership or admin.
       * @path /media/{mediaId}/comments/{commentId}
       * @allow (read) Anyone reads a comment on a media item.
       * @allow (create) User 'user123' creates a new comment on a media item.
       * @deny (update) User 'user456' tries to update a comment they don't own.
       * @principle Public read, authenticated create, owner/admin update/delete.
       */
      match /comments/{commentId} {
        allow get: if true;
        allow list: if true;
        allow create: if isSignedIn();
        allow update: if ownsDoc() || isAdmin();
        allow delete: if ownsDoc() || isAdmin();
      }

      /**
       * @description Allows signed-in users to read likes. Only the liking user can create a like. Likes can be deleted by the liking user or admin.
       * @path /media/{mediaId}/likes/{userId}
       * @allow (read) User 'user123' reads likes for a media item.
       * @allow (create) User 'user123' likes a media item.
       * @deny (create) User 'user456' tries to like a media item on behalf of 'user123'.
       * @principle Authenticated read, user-created likes, owner/admin delete.
       */
      match /likes/{userId} {
        allow get: if isSignedIn();
        allow list: if isSignedIn();
        allow create: if isSignedIn() && request.auth.uid == userId;
        allow update: if false;
        allow delete: if request.auth.uid == userId || isAdmin();
      }
    }

    /**
     * @description Allows anyone to read deities. Only admins can create, update, and delete.
     * @path /deities/{deityId}
     * @allow (read) Anyone reads a deity.
     * @allow (create) An admin creates a new deity.
     * @deny (update) User 'user123' tries to update a deity (only admins allowed).
     * @principle Public read, admin-only create/update/delete.
     */
    match /deities/{deityId} {
      allow get: if true;
      allow list: if true;
      allow create: if isAdmin();
      allow update: if isAdmin();
      allow delete: if isAdmin();
    }

    /**
     * @description Allows anyone to read temples. Only signed-in users can create. Update/delete requires ownership or admin.
     * @path /temples/{templeId}
     * @allow (read) Anyone reads a temple.
     * @allow (create) User 'user123' creates a new temple.
     * @deny (update) User 'user456' tries to update a temple they don't own.
     * @principle Public read, authenticated create, owner/admin update/delete.
     */
    match /temples/{templeId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();

      /**
       * @description Allows anyone to read reviews. Only signed-in users can create. Update/delete requires ownership or admin.
       * @path /temples/{templeId}/reviews/{reviewId}
       * @allow (read) Anyone reads a review for a temple.
       * @allow (create) User 'user123' creates a new review for a temple.
       * @deny (update) User 'user456' tries to update a review they don't own.
       * @principle Public read, authenticated create, owner/admin update/delete.
       */
      match /reviews/{reviewId} {
        allow get: if true;
        allow list: if true;
        allow create: if isSignedIn();
        allow update: if ownsDoc() || isAdmin();
        allow delete: if ownsDoc() || isAdmin();
      }

      /**
       * @description Allows anyone to read posts. Only signed-in users can create. Update/delete requires ownership or admin.
       * @path /temples/{templeId}/posts/{postId}
       * @allow (read) Anyone reads a post for a temple.
       * @allow (create) User 'user123' creates a new post for a temple.
       * @deny (update) User 'user456' tries to update a post they don't own.
       * @principle Public read, authenticated create, owner/admin update/delete.
       */
      match /posts/{postId} {
        allow get: if true;
        allow list: if true;
        allow create: if isSignedIn();
        allow update: if ownsDoc() || isAdmin();
        allow delete: if ownsDoc() || isAdmin();
      }
    }

    /**
     * @description Allows anyone to read stories, epic heroes, rituals, festivals, manifestations, and panchang. Requires sign-in and ownership or admin to create, update, or delete.
     * @path /stories/{storyId}, /epicHeroes/{heroId}, /rituals/{ritualId}, /festivals/{festivalId}, /manifestations/{manifestationId}, /panchang/{panchangId}
     * @allow (read) Anyone reads a story.
     * @allow (create) User 'user123' creates a new story.
     * @deny (update) User 'user456' tries to update a story they don't own.
     * @principle Public read, authenticated create, owner/admin update/delete.
     */
    match /stories/{storyId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();

          match /comments/{commentId} {
            allow get: if true;
            allow list: if true;
            allow create: if isSignedIn();
            allow update: if ownsDoc() || isAdmin();
            allow delete: if ownsDoc() || isAdmin();
          }

          match /likes/{userId} {
            allow get: if isSignedIn();
            allow list: if isSignedIn();
            allow create: if isSignedIn() && request.auth.uid == userId;
            allow update: if false;
            allow delete: if request.auth.uid == userId || isAdmin();
          }
    }
    match /epicHeroes/{heroId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();

          match /comments/{commentId} {
            allow get: if true;
            allow list: if true;
            allow create: if isSignedIn();
            allow update: if ownsDoc() || isAdmin();
            allow delete: if ownsDoc() || isAdmin();
          }

          match /likes/{userId} {
            allow get: if isSignedIn();
            allow list: if isSignedIn();
            allow create: if isSignedIn() && request.auth.uid == userId;
            allow update: if false;
            allow delete: if request.auth.uid == userId || isAdmin();
          }
    }
    match /rituals/{ritualId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();

          match /comments/{commentId} {
            allow get: if true;
            allow list: if true;
            allow create: if isSignedIn();
            allow update: if ownsDoc() || isAdmin();
            allow delete: if ownsDoc() || isAdmin();
          }

          match /likes/{userId} {
            allow get: if isSignedIn();
            allow list: if isSignedIn();
            allow create: if isSignedIn() && request.auth.uid == userId;
            allow update: if false;
            allow delete: if request.auth.uid == userId || isAdmin();
          }
    }
    match /festivals/{festivalId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();

          match /comments/{commentId} {
            allow get: if true;
            allow list: if true;
            allow create: if isSignedIn();
            allow update: if ownsDoc() || isAdmin();
            allow delete: if ownsDoc() || isAdmin();
          }

          match /likes/{userId} {
            allow get: if isSignedIn();
            allow list: if isSignedIn();
            allow create: if isSignedIn() && request.auth.uid == userId;
            allow update: if false;
            allow delete: if request.auth.uid == userId || isAdmin();
          }
    }
    match /manifestations/{manifestationId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();

          match /comments/{commentId} {
            allow get: if true;
            allow list: if true;
            allow create: if isSignedIn();
            allow update: if ownsDoc() || isAdmin();
            allow delete: if ownsDoc() || isAdmin();
          }

          match /likes/{userId} {
            allow get: if isSignedIn();
            allow list: if isSignedIn();
            allow create: if isSignedIn() && request.auth.uid == userId;
            allow update: if false;
            allow delete: if request.auth.uid == userId || isAdmin();
          }
    }
    match /panchang/{panchangId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();

          match /comments/{commentId} {
            allow get: if true;
            allow list: if true;
            allow create: if isSignedIn();
            allow update: if ownsDoc() || isAdmin();
            allow delete: if ownsDoc() || isAdmin();
          }

          match /likes/{userId} {
            allow get: if isSignedIn();
            allow list: if isSignedIn();
            allow create: if isSignedIn() && request.auth.uid == userId;
            allow update: if false;
            allow delete: if request.auth.uid == userId || isAdmin();
          }
    }

    /**
     * @description Allows anyone to read groups. Only signed-in users can create. Update/delete requires ownership or admin.
     * @path /groups/{groupId}
     * @allow (read) Anyone reads a group.
     * @allow (create) User 'user123' creates a new group.
     * @deny (update) User 'user456' tries to update a group they don't own.
     * @principle Public read, authenticated create, owner/admin update/delete.
     */
    match /groups/{groupId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();

      /**
       * @description Allows anyone to read group members. Only the joining user can create a member entry. Members can be deleted by the member or an admin.
       * @path /groups/{groupId}/members/{memberId}
       * @allow (read) Anyone reads the members of a group.
       * @allow (create) User 'user123' joins a group.
       * @deny (create) User 'user456' tries to join a group on behalf of 'user123'.
       * @principle Public read for social graph, authenticated create and owner/admin delete.
       */
      match /members/{memberId} {
        allow get: if true;
        allow list: if true;
        allow create: if isSignedIn() && request.auth.uid == memberId;
        allow update: if false;
        allow delete: if request.auth.uid == memberId || isAdmin();
      }
    }

    /**
     * @description Allows anyone to read posts. Only signed-in users can create. Update/delete requires ownership or admin.
     * @path /posts/{postId}
     * @allow (read) Anyone reads a post.
     * @allow (create) User 'user123' creates a new post.
     * @deny (update) User 'user456' tries to update a post they don't own.
     * @principle Public read, authenticated create, owner/admin update/delete.
     */
    match /posts/{postId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();

      /**
       * @description Allows anyone to read comments. Only signed-in users can create. Update/delete requires ownership or admin.
       * @path /posts/{postId}/comments/{commentId}
       * @allow (read) Anyone reads a comment on a post.
       * @allow (create) User 'user123' creates a new comment on a post.
       * @deny (update) User 'user456' tries to update a comment they don't own.
       * @principle Public read, authenticated create, owner/admin update/delete.
       */
      match /comments/{commentId} {
        allow get: if true;
        allow list: if true;
        allow create: if isSignedIn();
        allow update: if ownsDoc() || isAdmin();
        allow delete: if ownsDoc() || isAdmin();
      }

      /**
       * @description Allows signed-in users to read likes. Only the liking user can create a like. Likes can be deleted by the liking user or admin.
       * @path /posts/{postId}/likes/{userId}
       * @allow (read) User 'user123' reads likes for a post.
       * @allow (create) User 'user123' likes a post.
       * @deny (create) User 'user456' tries to like a post on behalf of 'user123'.
       * @principle Authenticated read, user-created likes, owner/admin delete.
       */
      match /likes/{userId} {
        allow get: if isSignedIn();
        allow list: if isSignedIn();
        allow create: if isSignedIn() && request.auth.uid == userId;
        allow update: if false;
        allow delete: if request.auth.uid == userId || isAdmin();
      }
    }

    /**
     * @description Allows anyone to read shops and products. Only admins can create, update, and delete.
     * @path /shops/{shopId}, /products/{productId}
     * @allow (read) Anyone reads a shop.
     * @allow (create) An admin creates a new shop.
     * @deny (update) User 'user123' tries to update a shop (only admins allowed).
     * @principle Public read, admin-only create/update/delete.
     */
    match /shops/{shopId} {
      allow get: if true;
      allow list: if true;
      allow create: if isAdmin();
      allow update: if isAdmin();
      allow delete: if isAdmin();
    }
    match /products/{productId} {
      allow get: if true;
      allow list: if true;
      allow create: if isAdmin();
      allow update: if isAdmin();
      allow delete: if isAdmin();
    }

    /**
     * @description Allows anyone to read channels, playlists, and challenges. Requires sign-in and ownership or admin to create, update, or delete.
     * @path /channels/{channelId}, /playlists/{playlistId}, /challenges/{challengeId}
     * @allow (read) Anyone reads a channel.
     * @allow (create) User 'user123' creates a new channel.
     * @deny (update) User 'user456' tries to update a channel they don't own.
     * @principle Public read, authenticated create, owner/admin update/delete.
     */
    match /channels/{channelId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();
    }
    match /playlists/{playlistId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();
    }
    match /challenges/{challengeId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();
    }

    /**
     * @description Catch-all for any other collections. Allows public read, authenticated create, and owner/admin write.
     * @path /{collectionName}/{docId}
     * @allow (read) Anyone reads any document in any collection.
     * @allow (create) User 'user123' creates a new document.
     * @deny (update) User 'user456' tries to update a document they don't own.
     * @principle Public read, authenticated create, owner/admin update/delete.
     */
    match /{collectionName}/{docId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if ownsDoc() || isAdmin();
      allow delete: if ownsDoc() || isAdmin();
    }
  }
}