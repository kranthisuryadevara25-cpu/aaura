/**
 * @fileoverview Firestore Security Rules for the aaura app.
 *
 * Core Philosophy:
 * This ruleset prioritizes user data ownership and prevents unauthorized access.
 * User-specific data is stored under the `/users/{userId}` path, and access is
 * generally restricted to the owning user. Top-level collections store public
 * content and community posts. The rules leverage denormalization to minimize
 * read operations in the security rules, improving performance.
 *
 * Data Structure:
 * - `/users/{userId}`: User profiles and related data.
 * - `/media/{mediaId}`: Publicly accessible media content.
 * - `/channels/{channelId}`: Publicly accessible channel content.
 * - `/playlists/{playlistId}`: Publicly accessible playlists.
 * - `/deities/{deityId}`: Publicly accessible deity information.
 * - `/shops/{shopId}`: Publicly accessible shop information.
 * - `/products/{productId}`: Publicly accessible product information.
 * - `/temples/{templeId}`: Publicly accessible temple data.
 * - `/stories/{storyId}`: Publicly accessible story content.
 * - `/epicHeroes/{heroId}`: Publicly accessible epic hero content.
 * - `/rituals/{ritualId}`: Publicly accessible ritual content.
 * - `/panchang/{date}`: Publicly accessible panchang data.
 * - `/festivals/{festivalId}`: Publicly accessible festival content.
 * - `/groups/{groupId}`: Publicly accessible community groups.
 * - `/posts/{postId}`: Publicly accessible posts in community groups, channels or temples.
 * - `/challenges/{challengeId}`: Publicly accessible challenges.
 * - `/contests/{contestId}`: Publicly accessible contests.
 * - `/manifestations/{manifestationId}`: Publicly accessible user-submitted manifestation stories.
 *
 * Key Security Decisions:
 * - User data is generally only accessible to the owning user.
 * - Public content is readable by all users.
 * - List operations are generally allowed for user-scoped subcollections.
 * - Relational integrity is enforced on document creation.
 * - Data validation is relaxed to allow for rapid iteration.
 *
 * Denormalization for Authorization:
 * - Ownership checks are performed by ensuring the `request.auth.uid` matches
 *   the `userId` in the path or in the document's `authorId` field.
 *
 * Structural Segregation:
 * - Public and private data are stored in separate top-level and user-scoped
 *   collections, respectively.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Checks if the request is authenticated.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Checks if the authenticated user's ID matches the provided userId.
     */
    function isOwner(userId) {
      return isSignedIn() && request.auth.uid == userId;
    }

    /**
     * @description Checks if the authenticated user is the owner of an existing document.
     */
    function isExistingOwner(userId) {
        return isOwner(userId) && resource != null;
    }

    /**
     * @description Enforces access control for user profiles.
     * @path /users/{userId}
     * @allow (create) User with matching UID can create their profile.
     * @allow (get) User can read their own profile.
     * @allow (update) User can update their own profile.
     * @allow (delete) User can delete their own profile.
     * @deny (create) User cannot create a profile with a different UID.
     * @deny (update) User cannot update someone else's profile.
     * @deny (delete) User cannot delete someone else's profile.
     * @principle Enforces document ownership for user profiles.
     */
    match /users/{userId} {
      allow get: if isOwner(userId);
      allow list: if false;
      allow create: if isOwner(userId);
      allow update: if isExistingOwner(userId);
      allow delete: if isExistingOwner(userId);
    }

    /**
     * @description Enforces access control for user contest progress.
     * @path /users/{userId}/contestProgress/{contestId}
     * @allow (create) User can create their contest progress if it matches their UID.
     * @allow (get) User can read their own contest progress.
     * @allow (update) User can update their own contest progress.
     * @allow (delete) User can delete their own contest progress.
     * @deny (create) User cannot create contest progress with a different UID.
     * @deny (update) User cannot update someone else's contest progress.
     * @deny (delete) User cannot delete someone else's contest progress.
     * @principle Enforces document ownership for user contest progress.
     */
    match /users/{userId}/contestProgress/{contestId} {
      allow get: if isOwner(userId);
      allow list: if isOwner(userId);
      allow create: if isOwner(userId);
      allow update: if isExistingOwner(userId);
      allow delete: if isExistingOwner(userId);
    }

    /**
     * @description Enforces access control for user followers.
     * @path /users/{userId}/followers/{followerId}
     * @allow (create) User can create a follower entry if the target user ID matches the path.
     * @allow (get) User can read their followers.
     * @allow (update) Not allowed.
     * @allow (delete) User can remove a follower if the target user ID matches the path.
     * @deny (create) User cannot create a follower entry for a different user.
     * @principle Enforces document ownership and relational integrity for user followers.
     */
    match /users/{userId}/followers/{followerId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if request.auth.uid == followerId;
        allow update: if false;
        allow delete: if isOwner(userId) && request.auth.uid == followerId && resource != null;
    }

    /**
     * @description Enforces access control for user following.
     * @path /users/{userId}/following/{followedId}
     * @allow (create) User can create a following entry if the user ID matches the path.
     * @allow (get) User can read who they are following.
     * @allow (update) Not allowed.
     * @allow (delete) User can remove a following entry if the user ID matches the path.
     * @deny (create) User cannot create a following entry for a different user.
     * @principle Enforces document ownership and relational integrity for user following.
     */
    match /users/{userId}/following/{followedId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if isOwner(userId) && request.auth.uid == userId;
        allow update: if false;
        allow delete: if isOwner(userId) && request.auth.uid == userId && resource != null;
    }

    /**
     * @description Enforces access control for user subscriptions.
     * @path /users/{userId}/subscriptions/{channelId}
     * @allow (create) User can create a subscription if the user ID matches the path.
     * @allow (get) User can read their subscriptions.
     * @allow (update) Not allowed.
     * @allow (delete) User can remove a subscription if the user ID matches the path.
     * @deny (create) User cannot create a subscription for a different user.
     * @principle Enforces document ownership and relational integrity for user subscriptions.
     */
    match /users/{userId}/subscriptions/{channelId} {
        allow get: if isOwner(userId);
        allow list: if isOwner(userId);
        allow create: if isOwner(userId) && request.auth.uid == userId;
        allow update: if false;
        allow delete: if isOwner(userId) && request.auth.uid == userId && resource != null;
    }

    /**
     * @description Enforces access control for user preferences.
     * @path /users/{userId}/preferences/default
     * @allow (get) User can read their own preferences.
     * @allow (update) User can update their own preferences.
     * @principle Enforces document ownership for user preferences.
     */
    match /users/{userId}/preferences/default {
      allow get: if isOwner(userId);
      allow list: if false;
      allow create: if isOwner(userId);
      allow update: if isExistingOwner(userId);
      allow delete: if false;
    }

    /**
     * @description Enforces access control for user badges.
     * @path /users/{userId}/badges/{badgeId}
     * @allow (get) User can read their own badges.
     * @allow (list) User can list their own badges.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Enforces document ownership for user badges.
     */
    match /users/{userId}/badges/{badgeId} {
      allow get: if isOwner(userId);
      allow list: if isOwner(userId);
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for user bookmarks.
     * @path /users/{userId}/bookmarks/{bookmarkId}
     * @allow (create) User can create a bookmark if the user ID matches the path.
     * @allow (get) User can read their own bookmarks.
     * @allow (list) User can list their own bookmarks.
     * @allow (update) User cannot update their own bookmarks.
     * @allow (delete) User can delete their own bookmarks.
     * @deny (create) User cannot create a bookmark for a different user.
     * @deny (update) User cannot update someone else's bookmark.
     * @deny (delete) User cannot delete someone else's bookmark.
     * @principle Enforces document ownership for user bookmarks.
     */
    match /users/{userId}/bookmarks/{bookmarkId} {
      allow get: if isOwner(userId);
      allow list: if isOwner(userId);
      allow create: if isOwner(userId) && request.auth.uid == userId;
      allow update: if false;
      allow delete: if isExistingOwner(userId);
    }

    /**
     * @description Enforces access control for user virtual offerings.
     * @path /users/{userId}/virtualOfferings/{offeringId}
     * @allow (create) User can create a virtual offering if the user ID matches the path.
     * @allow (get) User can read their own virtual offerings.
     * @allow (list) User can list their own virtual offerings.
     * @allow (update) User cannot update their own virtual offerings.
     * @allow (delete) User cannot delete their own virtual offerings.
     * @deny (create) User cannot create a virtual offering for a different user.
     * @deny (update) User cannot update someone else's virtual offering.
     * @deny (delete) User cannot delete someone else's virtual offering.
     * @principle Enforces document ownership for user virtual offerings.
     */
    match /users/{userId}/virtualOfferings/{offeringId} {
      allow get: if isOwner(userId);
      allow list: if isOwner(userId);
      allow create: if isOwner(userId) && request.auth.uid == userId;
      allow update: if false;
      allow delete: if isExistingOwner(userId);
    }

    /**
     * @description Enforces access control for user cart items.
     * @path /users/{userId}/cart/{productId}
     * @allow (create) User can add items to their own cart.
     * @allow (get) User can read their own cart items.
     * @allow (list) User can list their own cart items.
     * @allow (update) User can update items in their own cart.
     * @allow (delete) User can delete items from their own cart.
     * @principle Enforces document ownership for user cart items.
     */
    match /users/{userId}/cart/{productId} {
      allow get: if isOwner(userId);
      allow list: if isOwner(userId);
      allow create: if isOwner(userId) && request.auth.uid == userId;
      allow update: if isExistingOwner(userId);
      allow delete: if isExistingOwner(userId);
    }

    /**
     * @description Enforces access control for user playlists references.
     * @path /users/{userId}/playlists/{playlistId}
     *  @allow (create) User can create a playlist if the user ID matches the path.
     * @allow (get) User can read their playlist references.
     * @allow (list) User can list their own playlist references.
     * @allow (update) Not allowed.
     * @allow (delete) User can delete their own playlist references.
     * @principle Enforces document ownership for user playlists.
     */
    match /users/{userId}/playlists/{playlistId} {
      allow get: if isOwner(userId);
      allow list: if isOwner(userId);
      allow create: if isOwner(userId) && request.auth.uid == userId;
      allow update: if false;
      allow delete: if isExistingOwner(userId);
    }

    /**
     * @description Enforces access control for user challenge progress.
     * @path /users/{userId}/challenges/{challengeId}
     * @allow (create) User can create challenge progress if it matches their UID.
     * @allow (get) User can read their own challenge progress.
     * @allow (list) User can list their own challenge progress.
     * @allow (update) User can update their own challenge progress.
     * @allow (delete) User can delete their own challenge progress.
     * @deny (create) User cannot create challenge progress with a different UID.
     * @deny (update) User cannot update someone else's challenge progress.
     * @deny (delete) User cannot delete someone else's challenge progress.
     * @principle Enforces document ownership for user challenge progress.
     */
    match /users/{userId}/challenges/{challengeId} {
      allow get: if isOwner(userId);
      allow list: if isOwner(userId);
      allow create: if isOwner(userId);
      allow update: if isExistingOwner(userId);
      allow delete: if isExistingOwner(userId);
    }

    /**
     * @description Enforces access control for orders.
     * @path /orders/{orderId}
     * @allow (get) Anyone can get an order.
     * @allow (list) Not allowed.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Denies all write operations, read is allowed for now.
     */
    match /orders/{orderId} {
      allow get: if true;
      allow list: if false;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for media.
     * @path /media/{mediaId}
     * @allow (get) Anyone can read media.
     * @allow (list) Anyone can list media.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /media/{mediaId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

      /**
       * @description Enforces access control for comments on media items.
       * @path /media/{mediaId}/comments/{commentId}
       * @allow (get) Anyone can read comments on media.
       * @allow (list) Anyone can list comments on media.
       * @allow (create) Any signed-in user can create a comment.
       * @allow (update) Not allowed.
       * @allow (delete) Not allowed.
       * @principle Signed-in users can create comments, read access is public.
       */
      match /media/{mediaId}/comments/{commentId} {
          allow get: if true;
          allow list: if true;
          allow create: if isSignedIn();
          allow update: if false;
          allow delete: if false;
      }

      /**
       * @description Enforces access control for likes on media items.
       * @path /media/{mediaId}/likes/{userId}
       * @allow (create) User can like a media item if the user ID matches the path.
       * @allow (get) Anyone can get like
       * @allow (delete) User can unlike a media item if the user ID matches the path.
       * @principle Enforces document ownership for media likes.
       */
      match /media/{mediaId}/likes/{userId} {
        allow get: if true;
        allow list: if true;
        allow create: if isSignedIn() && request.auth.uid == userId;
        allow update: if false;
        allow delete: if isSignedIn() && request.auth.uid == userId && resource != null;
    }

    /**
     * @description Enforces access control for channels.
     * @path /channels/{channelId}
     * @allow (get) Anyone can read a channel.
     * @allow (list) Anyone can list channels.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /channels/{channelId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for channel subscribers.
     * @path /channels/{channelId}/subscribers/{userId}
     * @allow (create) User can subscribe to a channel if the user ID matches the path.
     * @allow (get) Anyone can get subscriber
     * @allow (delete) User can unsubscribe from a channel if the user ID matches the path.
     * @principle Enforces document ownership for channel subscribers.
     */
    match /channels/{channelId}/subscribers/{userId} {
        allow get: if true;
        allow list: if true;
        allow create: if isSignedIn() && request.auth.uid == userId;
        allow update: if false;
        allow delete: if isSignedIn() && request.auth.uid == userId && resource != null;
    }

    /**
     * @description Enforces access control for playlists.
     * @path /playlists/{playlistId}
     * @allow (get) Anyone can read a playlist.
     * @allow (list) Anyone can list playlists.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /playlists/{playlistId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for horoscopes.
     * @path /users/{userId}/horoscopes/{horoscopeId}
     * @allow (get) User can read their own horoscopes.
     * @allow (list) User can list their own horoscopes.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Enforces document ownership for horoscopes.
     */
    match /users/{userId}/horoscopes/{horoscopeId} {
      allow get: if isOwner(userId);
      allow list: if isOwner(userId);
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for deities.
     * @path /deities/{deityId}
     * @allow (get) Anyone can read a deity.
     * @allow (list) Anyone can list deities.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /deities/{deityId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for shops.
     * @path /shops/{shopId}
     * @allow (get) Anyone can read shop information.
     * @allow (list) Anyone can list shops.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /shops/{shopId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for products.
     * @path /products/{productId}
     * @allow (get) Anyone can read product information.
     * @allow (list) Anyone can list products.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /products/{productId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for temples.
     * @path /temples/{templeId}
     * @allow (get) Anyone can read temple data.
     * @allow (list) Anyone can list temples.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /temples/{templeId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for temple reviews.
     * @path /temples/{templeId}/reviews/{reviewId}
     * @allow (create) Any signed-in user can create a review.
     * @allow (get) Anyone can read a review.
     * @allow (list) Anyone can list reviews.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, signed-in users can create reviews.
     */
    match /temples/{templeId}/reviews/{reviewId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if false;
      allow delete: if false;
    }

   /**
     * @description Enforces access control for posts on temples.
     * @path /temples/{templeId}/posts/{postId}
     * @allow (get) Anyone can read a post.
     * @allow (list) Anyone can list posts.
     * @allow (create) Any signed-in user can create a post.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, signed-in users can create posts.
     */
    match /temples/{templeId}/posts/{postId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for stories.
     * @path /stories/{storyId}
     * @allow (get) Anyone can read a story.
     * @allow (list) Anyone can list stories.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /stories/{storyId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for epic heroes.
     * @path /epicHeroes/{heroId}
     * @allow (get) Anyone can read an epic hero.
     * @allow (list) Anyone can list epic heroes.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /epicHeroes/{heroId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for rituals.
     * @path /rituals/{ritualId}
     * @allow (get) Anyone can read a ritual.
     * @allow (list) Anyone can list rituals.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /rituals/{ritualId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for panchang data.
     * @path /panchang/{date}
     * @allow (get) Anyone can read panchang data.
     * @allow (list) Anyone can list panchang data.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /panchang/{date} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for festivals.
     * @path /festivals/{festivalId}
     * @allow (get) Anyone can read festival data.
     * @allow (list) Anyone can list festivals.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /festivals/{festivalId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for community groups.
     * @path /groups/{groupId}
     * @allow (get) Anyone can read a group.
     * @allow (list) Anyone can list groups.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /groups/{groupId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for group members.
     * @path /groups/{groupId}/members/{userId}
     * @allow (create) User can join a group if the user ID matches the path.
     * @allow (get) Anyone can get member.
     * @allow (delete) User can leave a group if the user ID matches the path.
     * @principle Enforces document ownership for group members.
     */
    match /groups/{groupId}/members/{userId} {
        allow get: if true;
        allow list: if true;
        allow create: if isSignedIn() && request.auth.uid == userId;
        allow update: if false;
        allow delete: if isSignedIn() && request.auth.uid == userId && resource != null;
    }

    /**
     * @description Enforces access control for posts in a group.
     * @path /posts/{postId}
     * @allow (get) Anyone can read a post.
     * @allow (list) Anyone can list posts.
     * @allow (create) Any signed-in user can create a post.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, signed-in users can create posts.
     */
    match /posts/{postId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for comments on a post.
     * @path /posts/{postId}/comments/{commentId}
     * @allow (get) Anyone can read a comment.
     * @allow (list) Anyone can list comments.
     * @allow (create) Any signed-in user can create a comment.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, signed-in users can create comments.
     */
    match /posts/{postId}/comments/{commentId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if false;
      allow delete: if false;
    }

      /**
       * @description Enforces access control for likes on posts.
       * @path /posts/{postId}/likes/{userId}
       * @allow (create) User can like a post if the user ID matches the path.
       *  @allow (get) Anyone can get like
       * @allow (delete) User can unlike a post if the user ID matches the path.
       * @principle Enforces document ownership for post likes.
       */
      match /posts/{postId}/likes/{userId} {
        allow get: if true;
        allow list: if true;
        allow create: if isSignedIn() && request.auth.uid == userId;
        allow update: if false;
        allow delete: if isSignedIn() && request.auth.uid == userId && resource != null;
    }

    /**
     * @description Enforces access control for challenges.
     * @path /challenges/{challengeId}
     * @allow (get) Anyone can read a challenge.
     * @allow (list) Anyone can list challenges.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, owner-only writes (not yet implemented).
     */
    match /challenges/{challengeId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

     /**
     * @description Enforces access control for contests.
     * @path /contests/{contestId}
     * @allow (get) Anyone can read a contest.
     * @allow (list) Anyone can list contests.
     * @allow (create) Not allowed.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     */
    match /contests/{contestId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for manifestations.
     * @path /manifestations/{manifestationId}
     * @allow (get) Anyone can read a manifestation.
     * @allow (list) Anyone can list manifestations.
     * @allow (create) Any signed-in user can create a manifestation.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, signed-in users can create manifestations.
     */
    match /manifestations/{manifestationId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for comments on a manifestation post.
     * @path /manifestations/{manifestationId}/comments/{commentId}
     * @allow (get) Anyone can read a comment on a manifestation post.
     * @allow (list) Anyone can list comments on a manifestation post.
     * @allow (create) Any signed-in user can create a comment on a manifestation post.
     * @allow (update) Not allowed.
     * @allow (delete) Not allowed.
     * @principle Public read, signed-in users can create comments.
     */
    match /manifestations/{manifestationId}/comments/{commentId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Enforces access control for likes on manifestations.
     * @path /manifestations/{manifestationId}/likes/{userId}
     * @allow (create) User can like a manifestation if the user ID matches the path.
     *  @allow (get) Anyone can get like
     * @allow (delete) User can unlike a manifestation if the user ID matches the path.
     * @principle Enforces document ownership for manifestation likes.
     */
    match /manifestations/{manifestationId}/likes/{userId} {
        allow get: if true;
        allow list: if true;
        allow create: if isSignedIn() && request.auth.uid == userId;
        allow update: if false;
        allow delete: if isSignedIn() && request.auth.uid == userId && resource != null;
    }
  }
}